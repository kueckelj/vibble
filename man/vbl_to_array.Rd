% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/vibble-io-nifti.R
\name{vbl_to_array}
\alias{vbl_to_array}
\title{Convert a vibble variable to a 3D array.}
\usage{
vbl_to_array(vbl, var, missing = 0, orientation = NULL)
}
\arguments{
\item{vbl}{A \link{vibble} containing voxel coordinates and at least one voxel-wise
variable.}

\item{var}{Name of the voxel-wise variable in \code{vbl} to be converted to an array.}

\item{missing}{Numeric value used to fill voxel locations that are not present in
\code{vbl}. Defaults to \code{0}.}

\item{orientation}{Optional character string specifying the desired output orientation
(e.g. \code{"LIP"}). If \code{NULL}, the original orientation attribute of
\code{vbl} is used.}
}
\value{
A numeric 3D array containing the values of \code{var}, arranged according
to the specified orientation and with missing voxels filled by
\code{missing}.
}
\description{
Create a dense 3D numeric array from a voxel-wise variable stored in a
\link{vibble}, optionally filling missing voxels and enforcing a specific
output orientation.
}
\details{
The function reconstructs a full voxel grid from the coordinate limits
stored in \code{ccs_limits(vbl)} and fills it with the values of \code{var}.
Any voxel locations not present in \code{vbl} are set to \code{missing}.

Before reshaping, the variable \code{var} is encoded as numeric:
\itemize{
\item logical: converted to \code{0/1}
\item factor / non-numeric: converted to factor (if needed) and then
to integer level codes
\item numeric: used as is
}

The output orientation is controlled by the \code{orientation} argument, a
three-letter code (e.g. \code{"LIP"}) describing the anatomical direction
of the \code{x}, \code{y}, and \code{z} axes. If \code{orientation} is
\code{NULL}, the function falls back to the original orientation stored as
an attribute of the vibble. Using \code{ccs_limits()} and \code{ccs_mapping()},
axes are flipped as required so that the resulting array matches the desired
orientation. The dense voxel grid is then reshaped to a 3D array via
\code{reshape2::acast()}.

The function assumes:
\itemize{
\item \code{vbl} is a valid \link{vibble} with integer \code{x}, \code{y},
\code{z} coordinates.
\item \code{ccs_limits(vbl)} returns numeric ranges for all three axes.
\item \code{orientation} passes \link{valid_orientation}().
}
}
\examples{
\dontrun{
# Convert a numeric variable to a 3D array in original orientation
arr <- vbl_to_array(vbl, var = "t1")

# Convert a mask variable and enforce LIP orientation, using 0 as background
arr_mask <- vbl_to_array(vbl, var = "mask", missing = 0, orientation = "LIP")
}

}
