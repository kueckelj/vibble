% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/vibble-io-nifti.R
\name{nifti_to_vbl}
\alias{nifti_to_vbl}
\title{Convert a NIfTI image into a vibble.}
\usage{
nifti_to_vbl(
  x,
  var = "value",
  lut = NULL,
  ordered = FALSE,
  add_id = FALSE,
  rm0 = TRUE,
  verbose = vbl_opts("verbose"),
  ...
)
}
\arguments{
\item{x}{A NIfTI object or a character path to a \code{.nii} or \code{.nii.gz} file.}

\item{var}{Character. The column name with which the data extracted from the nifti is stored
in vibble data.frame.}

\item{lut}{Either a file path to a LUT, character vector of labels or a data.frame with integer indices
and character labels.}

\item{ordered}{Logical. If a lookup table is provided, controls whether the
resulting labeled factor is ordered. Defaults to \code{FALSE}.}

\item{add_id}{Logical. If \code{TRUE}, add a unique voxel ID column.}

\item{rm0}{Logical. If \code{TRUE}, remove voxels with value 0 from the resulting
vibble. Replaces the deprecated argument \code{black_rm}.}

\item{verbose}{Logical. If \code{TRUE}, informative messages are printed in the
console.}

\item{...}{Additional arguments; currently supports the deprecated argument
\code{black_rm}.}
}
\value{
A \link{vibble}.
}
\description{
Create a \link{vibble} from a NIfTI object or file path by melting the voxel
data into long format.
}
\details{
The function accepts either a NIfTI object or a character file path. When a
path is supplied, the file is read without reorientation. If the original
NIfTI object has \code{@reoriented == TRUE}, a warning is issued because
voxel orientation may be unreliable.

Coordinate directions are extracted from the NIfTI header via
\code{RNifti::orientation()}. Axes are renamed to \code{x}, \code{y},
\code{z} according to the package's canonical coordinate mapping and - if required -
flipped.

The voxel values of the array in \verb{@.Data} are inspected and interpreted:

\itemize{
\item if binary 0/1 values → mask
\item if all integers & LUT provided → label
\item else -> numeric
}

If \code{lut} is supplied and the variable appears to represent labeled
classes, the lookup table is applied via \link{map_lut}(). Otherwise the
variable is left numeric with a message (depending on \code{verbose}).
}
\examples{
\dontrun{
# Basic usage
vbl <- nifti_to_vbl("t1_orig.nii.gz")

# With lookup table for labeled images
lut <- data.frame(index = 1:3, label = c("GM", "WM", "CSF"))
seg_vbl <- nifti_to_vbl("seg_regMNI.nii.gz", var = "tissue", lut = lut)

# Remove background voxels and add IDs
vbl <- nifti_to_vbl("mask.nii.gz", rm0 = TRUE, add_id = TRUE)
}

}
