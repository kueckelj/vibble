% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/vibble-io-nifti.R
\name{write_nifti}
\alias{write_nifti}
\title{Write NIfTI volume from a vibble}
\usage{
write_nifti(
  vbl,
  var,
  path_out,
  orientation = "RAS",
  missing = 0,
  datatype = NULL,
  path_native = NULL,
  path_target = NULL,
  path_lut = NULL,
  interp = NULL,
  path_fs = "/Applications/freesurfer/7.4.0",
  dir_temp = getwd(),
  verbose = vbl_def(),
  ...
)
}
\arguments{
\item{var}{Character scalar. Name of the variable in \code{vbl} to export as a NIfTI volume.}

\item{path_out}{Character scalar. The file path to the output NIfTI file (\code{.nii.gz}).}

\item{missing}{Numeric value used to fill voxel locations not present in \code{vbl} when
reconstructing the array.}

\item{path_target}{Optional character path to a target NIfTI volume. If provided, the output
volume is resampled into the target space using FreeSurfer \code{mri_vol2vol}.}

\item{path_lut}{Optional character path for a LUT CSV associated with labeled variables.
If \code{NULL} and the variable type is labeled, a default path is derived
from \code{path_out} by replacing \code{.nii.gz} with \verb{_lut.csv}.}

\item{interp}{Interpolation method for \code{mri_vol2vol}. One of \code{"cubic"}, \code{"linear"},
\code{"nearest"}. If \code{NULL}, defaults to \code{"cubic"} for numeric variables and
\code{"nearest"} for non-numeric variables.}

\item{path_fs}{File system path to the FreeSurfer installation used to source
\code{SetUpFreeSurfer.sh} and call \code{mri_vol2vol}.}

\item{dir_temp}{Directory for temporary files used during resampling.}
}
\value{
Invisibly returns \code{TRUE} in case of successfull execution.
}
\description{
Export a voxel-wise variable from a \link{vibble} as a NIfTI image using a
reference header, optional resampling to a target volume via FreeSurfer
\code{mri_vol2vol}, and optional LUT handling for labeled data.
}
\details{
The reference NIfTI is chosen as:
\itemize{
\item \code{path_ref} from \code{...}, read with \code{oro.nifti::readNIfTI()} if provided
\item otherwise \code{attr(vbl, "nifti")}, which must be a valid NIfTI object
}

The data array of the reference is replaced by the result of
\link{vbl_to_array}(), using the orientation from \code{RNifti::orientation(nii)}
and filling missing voxels with \code{missing}.

If \code{path_out} is a character path, the function writes a NIfTI file:
\itemize{
\item If \code{type == "label"} (from \link{var_type}()), a LUT is created
with \link{make_lut}(). If \code{path_lut} is not a character, it is
derived from \code{path_out} by replacing \code{.nii.gz} with \verb{_lut.csv}.
A message indicates the LUT path
\item If \code{path_target} is a character path, the volume is first written
to a temporary file and then resampled into the target space using
FreeSurfer \code{mri_vol2vol}. The interpolation method defaults to
\code{"cubic"} for numeric variables and \code{"nearest"} otherwise, unless
overridden via \code{interp}
\item If \code{path_target} is \code{NULL}, the NIfTI is written directly with
\code{oro.nifti::writeNIfTI()}
}

When \code{path_out} is not supplied, no file is written; only the modified NIfTI
object is returned invisibly.
}
