% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ggvibble-layers.R
\name{layer_text_ann}
\alias{layer_text_ann}
\title{Add text annotations to slices.}
\usage{
layer_text_ann(
  text,
  anchor = "top-left",
  ref_bb = "screen",
  sep = ": ",
  collapse = "\\n",
  alpha = 0.9,
  color = "white",
  size = 3.5,
  slices = NULL,
  hjust = vbl_def(),
  vjust = vbl_def(),
  ...
)
}
\arguments{
\item{text}{Text specification. See Details for more information.

\itemize{
\item{Character: } Flattened with \code{collapse} and drawn on every slice.
\item{data.frame: } Must contain a \code{slice} column.
\item{Named list of formulas: } Each named formula is evaluated per slice via
\link{summarise}(vbl2D, ..., .by = "slice").
}}

\item{ref_bb}{Character scalar indicating which \link[=vbl_doc_ref_bb]{2D reference bounding box}
to use when anchoring the text:
\itemize{
\item \code{"data"}: uses global bounding boxes from \link{data_bb}().
\item \code{"screen"}: uses screen-space bounding boxes from \link{screen_bb}().
\item \code{"slice"}: uses per-slice bounding boxes from \link{slice_bb}().
\item \code{"plot"}: uses the plot bounding box rom \link{plot_bb)}().
}}

\item{sep}{Character scalar used to separate names and values when \code{text} is a data.frame.}

\item{collapse}{Character scalar used to collapse multi-line text.}

\item{alpha, color, size}{Passed to \code{geom_text()} to define the text aesthetics.}

\item{slices}{Optional numeric \link[=is_slice]{slice indices} used to
restrict the layer to specific slices. If \code{NULL}, no restriction
is applied.}

\item{hjust, vjust}{Numeric scalars or \link[=vbl_def]{default}. Default justifications depend
on input for \code{anchor}. If \code{anchor} is specified as a character anchor definition, \code{hjust} and \code{vjust}
are picked such that the text is aligned to the respective side.}

\item{...}{Additional arguments passed to \code{ggplot2::geom_text()}.}
}
\value{
A \code{ggvibble_layer} object containing the supplied function. When
added to a \code{ggvibble}, the function is executed and its returned layers are
inserted into the plot.
}
\description{
Adds a per-slice text annotation layer using \code{ggplot2::geom_text()}.
}
\details{
Text handling depends on the type of \code{text}.

If \code{text} is a character vector, it is checked to be non-empty and flattened with
\code{collapse}. The resulting string is drawn on every slice of the incoming \code{vbl2D}.

If \code{text} is a data.frame, it must contain a valid \code{slice} column. The provided slices
are matched to the layer’s available slices. If no overlap exists, an error is raised reporting
both the provided slices and the layer’s slices. For each matched slice, all non-\code{slice}
columns are converted into \code{<name><sep><value>} strings and then combined using \code{collapse}.

If \code{text} is a named list of formulas, only named formulas are kept. Each formula is converted
to a quosure anchored in the caller environment and evaluated per slice using
\code{dplyr::summarise(vbl2D, .by = "slice", !!!text)}. The resulting summary columns are then
converted into \code{<name><sep><value>} strings and combined using \code{collapse}.

Positioning is computed per slice by selecting the reference bounding box specified by \code{ref_bb}
(\code{data_bb()}, \code{plot_bb()}, \code{screen_bb()}, or \code{slice_bb()}) and converting the chosen
\code{anchor} into absolute image coordinates via \code{as_img_anchor_abs()}.
}
